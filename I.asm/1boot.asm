org 7C00h            ;?????? ????? ????????? ????????????? ? ?????? ?????? ?????????
use16                    ;???????????? ????????????????? ???

cli                         ;?????????  ?????????? ??? ????? ??????? ? ?????????? ?????????
mov ax, 0              
mov es, ax
mov ds, ax
mov ss, ax
mov sp, 7C00h
sti;????????? ?????????? (????? ????????? ???????)
mov ax, 0010h     ;????????? ????? ?????? ??? ?????? ?????? ?? ?????
int 10h

macro print a,b,c,d
{
mov ax, 1301h
mov bp, a
mov dx, b
mov cx, c
mov bx, d
int 10h
}

macro get
{
mov ax, 0
int 16h
}

macro put c
{
mov ah, 0eh
mov bx, c
;mov cx, 1
int 10h
}
macro setcur
{
mov ah, 02h
mov bh, 00h
int 10h
}

macro getcur
{
mov ah, 03h
mov bh, 00h
int 10h
}



print stroka, 0000h, 0, 0000h
print stroka, 0000h, 21 , 000ah
print err0, 0100h, 8 , 000eh
print stroka, 0200h, 21 , 0004h
print stroka, 0300h, 21, 003ch
print stroka, 0400h, 21, 004ch

macro load
{
mov ecx, 0
mov cl, dh
mov esi, ecx
add esi, lba
mov [esi], dl
}
macro store
{
mov ecx, 0
mov cl, dh
mov esi, ecx
add esi, lba
mov dl, [esi]
}

jk:
get

getcur
cmp al, 8
je lot

cmp al, 13
je down

continue:

put 000fh
getcur


cmp al, 8
je back

load

jmp  jk

down:
inc dh
mov dl, 0
setcur
jmp jk


back:
mov ax, 0a20h
mov bx, 000fh
mov cx, 1
int 10h

jmp jk



up:
cmp dh, 0
je jk
dec dh
store
setcur
jmp back

jmp $

lot:
cmp dl, 0
je up
jmp continue

err0   db 'gasan :)'
stroka db 'Ok, MBR loaded again!'
close db 'close'

lba:
; +----------------------------------------------------------------------------------
; | ????????   ???                         ??????????                              
; |                                                                                 
; |   00h     byte                      ?????? ?????????                            
; |   01h     byte                       ???????????????                           
; |   02h     word                   ??????? ???????? ??????                        
; |   04h     dword        ????? ?????? ? ??????? ???????(word):????????(word)      
; |   08h     qword             ????????? ????? ??????? ??? ??????                  
; |   10h     qword  ????? 64 ??????? ?????? (???????????? ??? 32? ?????? FFFF:FFFF)
; +----------------------------------------------------------------------------------
db 15h
db 08h
dw 1515h                               ;???????? 1 ?????? - ?????? ??? ???? ?? ????
dd 1500000h                        ;???? ?????? ?????? ?????? ?????? ??? ? ??? ?? ???????? ?????                                                      ;????? ???????? ????  7?00h + 200h(512 ????) = 7E00h
dq 0000000000000000h        ;???????? ?????????? ? ??????? ??????? ? ??? ??? ????
dq 0000000000000000h


times 510 - ($ - $$) db 0       ;?????????? ?????? ?????????? ????? ?????????? ?????? ? ???-
db 0x55,0xAA                      ;??????? ????? ???????
